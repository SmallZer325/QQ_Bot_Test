# IP白名单配置指南

## 错误说明

如果遇到以下错误：
```
接口访问源IP不在白名单
错误代码: 401, 11298, 40023002
```

这是因为QQ开放平台要求配置IP白名单，只有白名单中的IP才能访问API。

## 解决方案

### 步骤1：获取你的公网IP

访问以下任一网站查看你的公网IP：
- https://www.ip138.com/
- https://ip.sb/
- https://whatismyipaddress.com/

或者使用命令行：
```powershell
# PowerShell
(Invoke-WebRequest -Uri "https://api.ip.sb/ip").Content.Trim()
```

### 步骤2：在QQ开放平台配置IP白名单

1. 访问 [QQ开放平台](https://bot.q.qq.com/)
2. 登录你的开发者账号
3. 进入你的机器人应用
4. 找到 **"开发设置"** 或 **"安全设置"** 选项
5. 找到 **"IP白名单"** 或 **"访问IP白名单"** 设置
6. 添加你的公网IP地址
7. 保存设置

### 步骤3：注意事项

- **家庭网络**：如果你的IP是动态的（每次重启路由器可能变化），需要：
  - 每次IP变化后更新白名单，或
  - 使用固定IP（联系网络运营商），或
  - 使用内网穿透服务（如frp、ngrok等）

- **公司/学校网络**：通常有固定IP，配置一次即可

- **云服务器**：通常有固定IP，配置一次即可

- **本地开发**：如果是在本地开发，可能需要：
  - 使用内网穿透工具将本地服务暴露到公网
  - 或者使用沙箱环境（is_sandbox=True）进行测试

### 步骤4：重新运行机器人

配置完IP白名单后，重新运行机器人：

```powershell
python bot.py
```

## 替代方案：使用沙箱环境

如果暂时无法配置IP白名单，可以使用沙箱环境进行测试（但可能无法真正发送消息）：

在 `bot.py` 中修改：
```python
client = MyClient(intents=intents, is_sandbox=True)
```

**注意**：沙箱环境主要用于测试，可能不会真正发送消息到QQ。

## 常见问题

### Q: 如何查看我的IP是否在白名单中？
A: 在QQ开放平台的安全设置中查看已配置的IP列表。

### Q: 我的IP经常变化怎么办？
A: 考虑使用：
1. 固定IP服务（联系网络运营商）
2. 内网穿透工具（frp、ngrok等）
3. 云服务器部署（有固定IP）

### Q: 可以使用通配符或IP段吗？
A: 根据QQ开放平台的设置，通常支持CIDR格式的IP段，如：`192.168.1.0/24`

